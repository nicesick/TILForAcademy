# AWS

## I. IAM

- 사용자에게 필요한 최소한의 권한만을 주기위한 방법



- 사용자추가
  - AWS 로그인 후 IAM 검색으로 > 사용자 추가 가능
    - 콘솔 비밀번호 : 기존 비밀번호
      - 후에 비밀번호 재지정
    - 권한 : AdministratorAccess
    - 태그 : 나중에 계정이 많아졌을 때, 태그를 이용해 태그에 속해있는 사용자만 권한을 바꾼다거나 한꺼번에 처리할 수 있게됨
    - 검토 : 지금까지 된 것 확인 후 생성



- 그룹추가
  - AWS 로그인 후 IAM 검색으로 > 그룹 추가 가능
    - 그룹 이름
    - 정책 : AdministratorAccess
    - 검토 : 이름과 정책 확인 후 생성



- 사용자 그룹으로
  - 생성된 그룹을 클릭하면 > 그룹에 사용자 추가를 누르면 추가 가능!



## II. MFA

- 뱅킹 사용할 때 쓰는 토큰이라고 생각하면 됨
- 이걸 사용하면 이중 보안을 할 수 있음



- 일단 루트 권한으로 로그인
- 핸드폰에서는 Authy 2-Factor Authentication 이라는 앱을 다운받음
- 로그인하면 > 루트 계정에서 MFA 활성화 탭이 있음
  - 보안 자격으로 들어오면
  - 멀티 팩터 인증 탭이 있는데, MFA 활성화를 누르면
  - QR 코드가 나오는데,
  - 핸드폰 앱으로 해당 QR 코드를 스캔하면 가입이 완료!
  - 밑에 코드 2개만 쓰면 활성화 된다!



## III. Tutorial

- https://aws.amazon.com/ko/getting-started/tutorials/
- 10분 자습서로 체험해보깈



## IV. 따라해보기

- 한국어로 바꾸고
- 지역을 아시아 태평양(서울) 으로 변경

- 필요한 기능들을 버튼으로 드래그 앤 드롭으로 설정 (VPC, EC2 를 상단으로 옮기자)

- 오늘의 할 일
  - 네트워크 구성
  - 웹서버 생성
  - 로드 밸런서 구성



- VPC 이론
  - 논리적으로 격리된 네트워크 공간?
  - 가용영역으로 운영될 수 있도록 지원 (데이터센터가 분리되어 있음)
  - CIDR : 내부 네트웍 주소 범위 지정 > 향후 확장할 시스템까지 고려해서 CIDR 을 생성해 주어야함



- VPC 생성
  - 이름 : JiHun-VPC
  - IPv4 : 10.0.0.0/16



- VPC-SubNet 생성
  - 이름 : JiHun-VPC-1
  - VPC
  - 가용 영역 : a 에 생성
  - IPv4 : 10.0.1.0/24



- VPC-SubNet 생성
  - 이름 : JiHun-VPC-2
  - VPC
  - 가용 영역 : c 에 생성
  - IPv4 : 10.0.2.0/24



- 인터넷 게이트웨이 생성
  - 이름 : JiHun-VPC-Gateway
  - 생성 후 > VPC 연결 선택 > 연결



- 라우팅 테이블 생성
  - 라우팅 탭 > 라우팅 편집
  - 라우팅 추가 > 0.0.0.0/0 > 인터넷 게이트웨이 라우팅
    - 10.0.0.0/16 > local : 10.0.** 이면 local 안에서 놀아라
    - 0.0.0.0/0 > gateway : 만약 다른 ip 라면 게이트웨이로 보내줘 (/0 이라는 게 중요해! > 아무 ip 를 의미하게 되니깐)
  - 서브넷 연결 탭 > 서브넷 연결 편집
    - 서브넷 2개를 모두 추가



- 만약 프라이빗 서브넷이 있다면?
  - 프라이빗을 위한 라우터 테이블을 따로 만들어 주어야 한다!



- 보안 그룹 생성 방법

  - NACL
  - 보안 그룹으로 정책 생성(기본적인 방법 + 쉽고 다양하게 사용 가능)

  - 보안그룹 탭 > 보안 그룹 생성
    - 이름 : JiHun-VPC-Security
    - VPC : JiHun-VPC



- 인바운드 규칙 생성
  - 인바운드 규칙 편집
  - 유형 : HTTP, SSH
  - 소스 : 0.0.0.0/0, ::/0 (단, 실제 상황에서는 모든 접근을 허용하면 안됨)



- 보안 그룹 장점
  - 인바운드로 들어올 수 있는 데이터는 아웃바운드가 허용되어있지 않을 경우에도 나갈 수 있다



- EC2 시작하기
  - 가용영역 A 에 EC2 웹서버를 만들어보자
  - 인스턴스 생성 > 인스턴스 시작
  - 미리 제공되는 이미지를 선택
  - 유형 선택 > t2.micro
  - 설치할 VPC 선택 > JiHun-VPC
  - 서브넷 : a
  - IP 자동 할당 : 활성화
  - 고급 세부 정보 추가
    - #include https://s3.amazonaws.com/immersionday-labs/bootstrap.sh
  - 태그 추가
    - Name : JiHun-VPC-webserver1
  - 보안 그룹 구성
    - 기존 보안 그룹 선택 : JiHun-VPC
  - 키 페어 선택 > 새 키 페어 생성 > AWS101 : 키 페어 다운로드 (인증할 때 필요)



- 접속
  - EC2 연결 > 브라우저 기반 연결



- 서버 이미지 생성
  - 작업 > 이미지 > 이미지 생성
  - 이미지 > AMI > 시작하기 선택
  - 그저 복사만 했을 뿐인데... > 서버에 접속할 수 있음!!



- 로드 밸런서 생성
  - 로드 밸런서 탭 > 로드 밸런서 생성
  - HTTP 프로토콜 로드밸런서 생성
    - 이름 : JiHun-VPC-elb
    - 가용영역 선택 : a, c
    - 태그 선택
      - Name : JiHun-VPC-elb
    - 보안 그룹 선택
      - 대신 로드 밸런서들의 보안 그룹은 따로 만들어야 함
        - 로드 밸런서 인바운드 모든 포트를 열어두고
        - 서브넷의 보안 그룹에서는 인바운드를 조건을 주면 됨
    - 라우팅 구성
      - 이름 : JiHun-VPC-webserver-targetgroup
      - 고급 상태 검사 설정
        - 정상 임계 값 : 2 (두 번 받으면 정상)
        - 비정상 임계 값 : 2 (두 번 못받으면 비정상)
    - 대상 등록
      - 해당 인스턴스 선택 > 추가
    - 로드 밸런서로 접근
      - DNS 복사해서 접근